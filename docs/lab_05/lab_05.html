
<!DOCTYPE html>


<html lang="fr" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Laboratoire 5 --- Développement de drivers kernel-space II &#8212; Documentation DRV 2025 </title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/color.css?v=8770e769" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=72dce1d2"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/translations.js?v=bf059b8c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lab_05/lab_05';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="prev" title="Tutoriel 3 --- REDS-adder driver v2.1 et v3.1" href="../tuto_03/tuto_03.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Passer au contenu principal</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Haut de page</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Alerte de version"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_drv.png" class="logo__image only-light" alt="Documentation DRV 2025  - Home"/>
    <img src="../_static/logo_drv.png" class="logo__image only-dark pst-js-only" alt="Documentation DRV 2025  - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Recherche</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../helper/helper.html">Helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helper/eval_criterion.html">Consigne de rendu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_00/lab_00.html">Laboratoire 0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_01/lab_01.html">Laboratoire 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helper/ssh.html">Mise en place SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tuto_01/tuto_01.html">Tuto 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_02/lab_02.html">Laboratoire 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tuto_02/tuto_02.html">Tuto 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_03/lab_03.html">Laboratoire 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lab_04/lab_04.html">Laboratoire 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tuto_03/tuto_03.html">Tuto 3</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Laboratoire 5</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lab_05/lab_05.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Thème" data-bs-title="Thème"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Clair"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Sombre"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="Paramètres système"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Laboratoire 5 --- Développement de drivers kernel-space II</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectifs">Objectifs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#materiel-necessaire">Matériel nécessaire</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thread-noyau-kthread">Thread noyau (kthread)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timer-ktimer">Timer (ktimer)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#queue-kfifo">Queue (kfifo)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercices">Exercices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sysfs">Sysfs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronisation">Synchronisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#travail-a-rendre-et-criteres-d-evaluation">Travail à rendre et critères d'évaluation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="laboratoire-5-developpement-de-drivers-kernel-space-ii">
<span id="laboratoire5"></span><h1>Laboratoire 5 --- Développement de drivers kernel-space II<a class="headerlink" href="#laboratoire-5-developpement-de-drivers-kernel-space-ii" title="Lien vers cette rubrique">#</a></h1>
<figure class="align-right">
<a class="reference internal image-reference" href="../_images/logo_drv.png"><img alt="../_images/logo_drv.png" src="../_images/logo_drv.png" style="width: 6cm;" /></a>
</figure>
<section id="objectifs">
<h2>Objectifs<a class="headerlink" href="#objectifs" title="Lien vers cette rubrique">#</a></h2>
<ul class="simple">
<li><p>Savoir gérer les threads et timers en kernel-space</p></li>
<li><p>Savoir utiliser les queues en kernel-space</p></li>
<li><p>Savoir utiliser les mécanismes pour la configuration depuis le user-space (<em>command line parameters</em>, <em>sysfs</em>, ...)</p></li>
<li><p>Connaître les mécanismes principaux de synchronisation</p></li>
</ul>
</section>
<section id="materiel-necessaire">
<h2>Matériel nécessaire<a class="headerlink" href="#materiel-necessaire" title="Lien vers cette rubrique">#</a></h2>
<p>Ce laboratoire utilise le même environnement que le laboratoire précédent,
qui peut donc être réutilisé.</p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Lien vers cette rubrique">#</a></h2>
<section id="thread-noyau-kthread">
<h3>Thread noyau (kthread)<a class="headerlink" href="#thread-noyau-kthread" title="Lien vers cette rubrique">#</a></h3>
<p>Il est possible pour un module de démarrer des taches d'arrière-plan, d'effectuer un polling
sur un périphérique à intervalle régulier, ou encore de déléguer le traitement d'une interruption
à un thread afin de ne pas rester dans une routine d'interruption trop longtemps.
Nous avons vu plusieurs mécanismes en cours:</p>
<ul class="simple">
<li><p>La &quot;threaded IRQ&quot;, qui est spécifique à la gestion des interruptions</p></li>
<li><p>Le thread en espace noyau (kthread)</p></li>
<li><p>La workqueue (qui utilise derrière un ou plusieurs kthreads)</p></li>
</ul>
<p>Le kthread est le mécanisme le plus générique.
La macro <code class="code highlight c docutils literal highlight-c"><span class="n">kthread_run</span><span class="p">()</span></code> permet de créer un kthread et de la démarrer automatiquement.
En <em>arrière-plan</em>, cette macro fait appel à <code class="code highlight c docutils literal highlight-c"><span class="n">kthread_create</span><span class="p">()</span></code>, qui crée le kthread sans le démarrer et <code class="code highlight c docutils literal highlight-c"><span class="n">wake_up_process</span><span class="p">()</span></code> qui le démarre.
Ces deux fonctions peuvent également être utilisées séparément en fonction des besoins.</p>
<p>Un kthread peut ensuite se terminer de deux manières différentes :</p>
<ul class="simple">
<li><p>de manière <em>spontanée</em>, en faisant un simple <code class="code highlight c docutils literal highlight-c"><span class="k">return</span></code></p></li>
<li><p>lorsque <code class="code highlight c docutils literal highlight-c"><span class="n">kthread_stop</span><span class="p">()</span></code> a été appelé depuis un autre thread.</p></li>
</ul>
<p><code class="code highlight c docutils literal highlight-c"><span class="n">kthread_stop</span><span class="p">()</span></code> ne tue pas le thread directement,
mais active un flag partagé (comme dans la librairie pco-synchro ;-) indiquant que le thread
doit s'arrêter et bloque en attendant que le thread se termine.
Ce flag peut être testé depuis le kthread au moyen  de la fonction <code class="code highlight c docutils literal highlight-c"><span class="n">kthread_should_stop</span><span class="p">()</span></code>.
Le kthread doit contrôler périodiquement cette valeur s'il s'attend à être stoppé.
La valeur de retour de <code class="code highlight c docutils literal highlight-c"><span class="n">kthread_stop</span><span class="p">()</span></code> correspond à la valeur de retour de la fonction du kthread.</p>
<p>Un thread peut être mis en attente bloquante grâce à la fonction <code class="code highlight c docutils literal highlight-c"><span class="n">wait_event</span><span class="p">()</span></code> (et ses nombreuses variantes).
Cette fonctnion prend comme
paramètre une queue sur laquelle le thread attend et une condition qui doit être respectée pour que
ce thread se réveille.
Le thread peut ensuite être réveillé via un appel à <code class="code highlight c docutils literal highlight-c"><span class="n">wake_up</span><span class="p">()</span></code> (et autres variantes), prenant comme paramètre
la queue de threads à réveiller.
Vous pouvez trouver une description de ces fonctions
<a class="reference external" href="https://www.kernel.org/doc/html/latest/driver-api/basics.html#wait-queues-and-wake-events">ici</a>.
Sur le même principe, il est également possible d'utiliser <code class="code highlight c docutils literal highlight-c"><span class="n">wait_for_completion</span><span class="p">()</span></code> et <code class="code highlight c docutils literal highlight-c"><span class="n">complete</span><span class="p">()</span></code>
dont la documentation est disponible <a class="reference external" href="https://www.kernel.org/doc/html/latest/scheduler/completion.html">ici</a>.</p>
<p>Un exemple d'utilisation de kthread est disponible dans le dossier <code class="file docutils literal notranslate"><span class="pre">example/</span></code> dans les sources du labo.</p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Attention, ce module écrit régulièrement dans les logs du kernel !
Ne le laissez pas inséré trop longtemps, au risque de petit à petit remplir votre espace disque !</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Indication</p>
<p>Vous ferez peut-être connaissance avec <em>khungtaskd</em> durant le laboratoire si vous
utilisez des attente non-interuptible (uninterruptible wait, affichés &quot;D&quot; dans la sortie de la commande <code class="code highlight console docutils literal highlight-console"><span class="go">ps</span></code>).</p>
<p>En effet, ce mécanisme
est généralement activé par défaut (au moyen de la configuration CONFIG_DETECT_HUNG_TASK)
et va périodiquement vérifier les tâches en attente non-interuptible et avertir si certaines
sont &quot;coincées&quot; dans cet état en affichant un message &quot;task xyz:PID blocked for more than yyy seconds&quot;
avec une <em>backtrace</em> de cette tâche.</p>
<p>Une solution est de recourir à une attente interruptible si votre tâche doit effectivement
bloquer pendant une longue période de temps.
Un autre moyen est de faire comme suggéré dans le message
d'erreur est de désactiver <em>khungtaskd</em> en écrivant 0 dans
<code class="code highlight console docutils literal highlight-console"><span class="go">/proc/sys/kernel/hung_task_timeout_secs</span></code>, mais ce message a probablement une bonne raison d'être...</p>
</div>
</section>
<section id="timer-ktimer">
<h3>Timer (ktimer)<a class="headerlink" href="#timer-ktimer" title="Lien vers cette rubrique">#</a></h3>
<p>Un module peut également faire appel aux timers s'il désire effectuer une tâche cyclique ou compter
précisément un intervalle de temps.
L'interface des timers a beaucoup changé, et il est assez difficile de trouver des exemples qui fonctionnent
(la plupart ne compilent même pas !). Vous pouvez trouver une description de la nouvelle interface
<a class="reference external" href="https://lwn.net/Articles/735887/">ici</a>.</p>
<p>Les principales fonctions sont <code class="code highlight c docutils literal highlight-c"><span class="n">timer_setup</span><span class="p">()</span></code> et <code class="code highlight c docutils literal highlight-c"><span class="n">mod_timer</span><span class="p">()</span></code>, dont vous trouverez la documentation
dans les <a class="reference external" href="https://elixir.bootlin.com/linux/v6.1.131/source">souces du noyau</a>.</p>
<p>Un exemple d'utilisation de ktimer est disponible dans le dossier <code class="file docutils literal notranslate"><span class="pre">example/</span></code> dans les sources du
laboratoire.</p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Attention, ce module écrit régulièrement dans les logs du kernel !
Ne le laissez pas inséré trop longtemps, au risque de petit à petit remplir votre espace disque !</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Indication</p>
<p>Les ktimer s'exécute en tant que <em>softirq</em>, soit un contexte d'interruption où il est interdit de bloquer,
tout comme une interruption matériel.
Il faut donc faire très attention aux fonctions que vous appelez, et notamment aux primitives
de synchronisation que vous utiliserez dans le dernier exercice.</p>
</div>
</section>
<section id="queue-kfifo">
<h3>Queue (kfifo)<a class="headerlink" href="#queue-kfifo" title="Lien vers cette rubrique">#</a></h3>
<p>Un type de structure de données très souvent utilisé lorsque l'on intéragit avec un
vrai périphérique est la queue, aussi appelée <strong>kfifo</strong>.
Le noyau offre une interface qui vous permet facilement d'insérer et de retirer
des éléments.
L'interface est détaillée <a class="reference external" href="https://www.kernel.org/doc/html/latest/core-api/kernel-api.html#fifo-buffer">ici</a>, et
des exemples d'utilisation sont disponibles dans le sous-répertoire <code class="file docutils literal notranslate"><span class="pre">samples</span></code> des sources
du noyau.</p>
<div class="admonition hint">
<p class="admonition-title">Indication</p>
<p>Une kfifo offre des garanties limitées en ce qui concerne les accès concurrents.
Aucun verrouillage n'est nécessaire tant que vous avez un seul lecteur et un seul rédacteur.
Mais un verrouillage devient nécessaire dès que vous avez plus que un lecteur et/ou rédacteur.
Voir le commentaire dans le header
<a class="reference external" href="https://elixir.bootlin.com/linux/v6.1.131/source/include/linux/kfifo.h#L30">kfifo.h</a>.</p>
</div>
</section>
</section>
<section id="exercices">
<h2>Exercices<a class="headerlink" href="#exercices" title="Lien vers cette rubrique">#</a></h2>
<div class="admonition-exercice-1-kfifo-et-kthread admonition">
<p class="admonition-title"><strong>Exercice 1 : kfifo et kthread</strong></p>
<p>Implémentez un module du noyau qui permet la gestion d'un chenillard (<em>chaser</em>) sur les 10 LEDs de la carte DE1-SoC, afin de réaliser les effets lumineux du prochain Baleinev !
Le but sera d'allumer séquentiellement les LEDs à intervalle régulier, soit de façon montante (LED0 -&gt; LED1, etc.), soit de façon descendante (LED9 -&gt; LED8, etc.).
Le type de séquence (montante ou descendante) sera contrôlé par l'utilisateur.</p>
<p>Nous ajouterons le contrôle de l'intervalle, ainsi que la gestion des accès concurrents, dans les prochains exercices.
Choisissez pour l'instant une valeur par défaut pour l'intervalle qui soit raisonnable, par exemple 1 seconde, afin de pouvoir facilement débugger votre module.
Libre à vous de rendre cette valeur par défaut configurable lorsque le module est inséré (au moyen d'un paramètre), mais cela n'est pas obligatoire.</p>
<p>Le driver doit exposer le <em>device node</em> <code class="code highlight c docutils literal highlight-c"><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">chaser</span></code> qui permet à l'utilisateur de démarrer une nouvelle séquence :</p>
<ul class="simple">
<li><p><code class="code highlight console docutils literal highlight-console"><span class="go">echo &quot;up&quot; &gt; /dev/chaser</span></code> démarre une séquence montante (LED0 -&gt; LED9)</p></li>
<li><p><code class="code highlight console docutils literal highlight-console"><span class="go">echo &quot;down&quot; &gt; /dev/chaser</span></code> démarre une séquence descendante (LED9 -&gt; LED0)</p></li>
<li><p>Tout autre écriture devra être ignorée et un message d'erreur sera imprimé dans les logs du noyau</p></li>
</ul>
<p>Il est possible à l'utilisateur de démarrer plusieurs séquences sans attendre la fin de la séquence en cours.
Elles doivent être mémorisées (au moyen d'une <strong>kfifo</strong>) afin d'être jouées à la suite, jusqu'à un maximum de 16 séquences en mémoire.
Par exemple, la séquence suivante :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;up&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/chaser
<span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;down&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/chaser
<span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;up&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/chaser
<span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;down&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/chaser
</pre></div>
</div>
<p>devrait permettre de réaliser un effet proche de &quot;K2000&quot; dans le cas où une soirée &quot;Nostalgie 80's&quot; était organisée
(<a class="reference external" href="https://www.youtube.com/watch?v=oNyXYPhnUIs">pour les plus jeunes d'entre vous</a> qui ne sont pas nés dans les 1980).</p>
<p>La lecture du <em>device node</em> en fait rien.</p>
<p>Pour cet exercice, le contrôle des LEDs se fera dans un <strong>kthread</strong> qui est démarré quand le module est inséré dans le noyau.
Ce kthread sera évidemment proprement terminé quand le module est enlevé.
Ce kthread devra donc attendre que l'utilisateur écrive une séquence, puis animer les LEDs selon les instructions.
L'intervalle entre chaque animation sera effectuée au moyen d'un <code class="code highlight c docutils literal highlight-c"><span class="n">msleep</span><span class="p">()</span></code> pour l'instant.</p>
<p>Une fois que la séquence est terminée, les LEDs sont éteintes et le kthread attendra la séquence suivante
(ou commencera directement à la jouer si une séquence est déjà dans la file d'attente).</p>
<div class="admonition hint">
<p class="admonition-title">Indication</p>
<p>Ce module sera complété dans les prochains exercices, mais un seul fichier est demandé à la fin.
Libre à vous de regarder les prochains exercices et de tout implémenter directement ou d'y aller
exercice par exercice.</p>
</div>
</div>
<div class="admonition-exercice-2-ktimer admonition">
<p class="admonition-title"><strong>Exercice 2 : ktimer</strong></p>
<p>Le comité de Baleinev se plaint que votre chenillard a trop de <em>jitter</em> car le <code class="code highlight c docutils literal highlight-c"><span class="n">msleep</span><span class="p">()</span></code> n'est pas assez précis quand le système est trop surchargé.</p>
<p>Reprenez le code de l'exercice précédent et réalisez l'animation des LEDs au moyen d'un <strong>ktimer</strong>.
Gardez le <strong>kthread</strong> pour la gestion de la file d'attente, et démarrer le timer lorsqu'une nouvelle séquence doit être jouée.
Le timer est ensuite responsable de l'animation de la séquence à intervalle régulier et s'arrête lorsque la séquence est finie.</p>
<p>Le kthread doit attendre la fin de la séquence avant de s'occuper de la séquence suivante (ou d'attendre que l'utilisateur soumette une nouvelle requête).</p>
</div>
</section>
<section id="sysfs">
<h2>Sysfs<a class="headerlink" href="#sysfs" title="Lien vers cette rubrique">#</a></h2>
<p><em>Once upon a time...</em> une interface permettait aux utilisateurs d'interagir
avec le noyau Linux.
Le nom de cette interface était <strong>procfs</strong>, et consistait en un filesystem virtuel avec lequel
le noyau pouvait montrer au user-space des informations sur son fonctionnement et il pouvait
récupérer des paramètres de configuration.
Malheureusement, avec le temps ce filesystem est devenu de plus en plus encombré par des
informations non pertinentes, mais la stabilité de l'ABI avec le user-space
empêchait de faire le ménage.
Ainsi, il a été décidé de repartir de zéro, mais d'une façon plus structurée, avec <strong>sysfs</strong>,
tout en gardant procfs pour le coeur du noyau.
En tant que développeur driver, vous êtes donc censés utiliser sysfs !</p>
<p>Le répertoire du dispositif reds-adder v1.1 (voir <a class="reference internal" href="../tuto_02/tuto_02.html#tutoriel2"><span class="std std-ref">Tutoriel 2 ---  REDS-adder driver v0.1 et v1.1</span></a>) dans <code class="file docutils literal notranslate"><span class="pre">/sys</span></code> existe déjà
(grâce à l'appel à
<code class="code highlight c docutils literal highlight-c"><span class="n">misc_register</span><span class="p">()</span></code>). On peut le voir dans <code class="file docutils literal notranslate"><span class="pre">/sys/class/misc/</span></code> (car il
s'agit d'un miscellaneous device, c.-à-d., il appartient au miscellaneous
framework). En regardant les liens symboliques dans ce répertoire, on voit qu'il
est aussi enregistré en tant que platform device (et donc il a son propre
répertoire <code class="file docutils literal notranslate"><span class="pre">/sys/devices/platform/ff205000.reds-adder</span></code>).
Si l'on veut exposer des informations (soit pour nous aider dans le
debugging, soit pour nous permettre de configurer notre dispositif), on peut
créer des fichiers. Ces fichiers peuvent être de trois types :</p>
<ul class="simple">
<li><p>en lecture seule (<code class="code highlight c docutils literal highlight-c"><span class="n">DEVICE_ATTR_RO</span></code>)</p></li>
<li><p>en écriture seule (<code class="code highlight c docutils literal highlight-c"><span class="n">DEVICE_ATTR_WO</span></code>)</p></li>
<li><p>en lecture/écriture (<code class="code highlight c docutils literal highlight-c"><span class="n">DEVICE_ATTR_RW</span></code>)</p></li>
</ul>
<p>Le noyau nous offre des macros pour nous aider dans la création de ces fichiers.
Par exemple, <code class="code highlight c docutils literal highlight-c"><span class="n">DEVICE_ATTR_RW</span><span class="p">(</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">)</span></code> permet d'instancier une structure <code class="code highlight c docutils literal highlight-c"><span class="n">device_attribute</span></code>
et de l'associer aux deux fonctions <code class="code highlight c docutils literal highlight-c"><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">_store</span><span class="p">()</span></code> (écriture) et <code class="code highlight c docutils literal highlight-c"><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">_show</span><span class="p">()</span></code> (lecture).
La macro <code class="code highlight c docutils literal highlight-c"><span class="n">DEVICE_ATTR</span><span class="p">()</span></code> permet d'instancier la structure de manière plus générique,
en donnant explicitement les permissions d'accès aux fichiers et les fonctions <code class="code highlight c docutils literal highlight-c"><span class="n">store</span></code> et <code class="code highlight c docutils literal highlight-c"><span class="n">show</span></code>.
D'autres macros sont également disponibles, <a class="reference external" href="https://www.kernel.org/doc/html/latest/driver-api/infrastructure.html#c.DEVICE_ATTR">voir la documentation</a></p>
<p>On n'aura ensuite qu'à appeler <code class="code highlight c docutils literal highlight-c"><span class="n">device_create_file</span><span class="p">()</span></code> en lui passant notre
dispositif et un pointeur à la structure <code class="code highlight c docutils literal highlight-c"><span class="n">dev_attr_</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span></code> créée par l'une des macros
ci-dessus, et on obtiendra notre fichier dans sysfs.
Cette procédure est présentée dans le driver reds-adder v2.1 (voir <a class="reference internal" href="../tuto_03/tuto_03.html#tutoriel3"><span class="std std-ref">Tutoriel 3 ---  REDS-adder driver v2.1 et v3.1</span></a>).</p>
<p>Dans la fonction <code class="code highlight c docutils literal highlight-c"><span class="p">...</span><span class="n">_store</span><span class="p">()</span></code>, on est censé lire une valeur venant l'utilisateur,
par exemple en utilisant la fonction <code class="code highlight c docutils literal highlight-c"><span class="n">kstrtoint</span><span class="p">()</span></code>
(voir <a class="reference external" href="https://www.kernel.org/doc/htmldocs/kernel-api/API-kstrtoint.html">ici</a>)
ou avec <code class="code highlight c docutils literal highlight-c"><span class="n">sscanf</span><span class="p">()</span></code>.
Dans la fonction <code class="code highlight c docutils literal highlight-c"><span class="p">...</span><span class="n">_show</span><span class="p">()</span></code>, on retourne à l'utilisateur une valeur,
les fonctions <code class="code highlight c docutils literal highlight-c"><span class="n">sysfs_emit</span><span class="p">()</span></code> et <code class="code highlight c docutils literal highlight-c"><span class="n">sysfs_emit_at</span><span class="p">()</span></code>
(même fonctionnement que <code class="code highlight c docutils literal highlight-c"><span class="n">scnprintf</span><span class="p">()</span></code> voir <a class="reference external" href="https://www.kernel.org/doc/html/latest/filesystems/api-summary.html#c.sysfs_emit">ici</a>)</p>
<p>Voici un exemple d'utilisation :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">my_nice_name_store</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">device</span><span class="w"> </span><span class="o">*</span><span class="n">dev</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">struct</span><span class="w"> </span><span class="nc">device_attribute</span><span class="w"> </span><span class="o">*</span><span class="n">attr</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span>
<span class="w">                                  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">priv</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dev_get_drvdata</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="w">        </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kstrtoint</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">my_internal_variable</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">my_nice_name_show</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">device</span><span class="w"> </span><span class="o">*</span><span class="n">dev</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">struct</span><span class="w"> </span><span class="nc">device_attribute</span><span class="w"> </span><span class="o">*</span><span class="n">attr</span><span class="p">,</span>
<span class="w">                                 </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">priv</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dev_get_drvdata</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="w">        </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sysfs_emit</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">my_internal_variable</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="n">DEVICE_ATTR_RW</span><span class="p">(</span><span class="n">my_nice_name</span><span class="p">);</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">my_driver_probe</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">platform_device</span><span class="w"> </span><span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="cm">/* ... */</span>
<span class="w">        </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device_create_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dev_attr_my_nice_name</span><span class="p">);</span>
<span class="w">        </span><span class="cm">/* ... */</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">my_driver_remove</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">platform_device</span><span class="w"> </span><span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="cm">/* ... */</span>
<span class="w">        </span><span class="n">device_remove_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dev_attr_my_nice_name</span><span class="p">);</span>
<span class="w">        </span><span class="cm">/* ... */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Bien sûr, dans la fonction <code class="code highlight c docutils literal highlight-c"><span class="p">...</span><span class="n">_store</span><span class="p">()</span></code>, on pourrait aussi modifier le
comportement du dispositif, en ajoutant une <code class="code highlight c docutils literal highlight-c"><span class="n">iowrite32</span><span class="p">()</span></code> sur le dispositif par exemple.</p>
<p>L'entrée <strong>sysfs</strong> créée par cet exemple est disponible dans <code class="file docutils literal notranslate"><span class="pre">/sys/devices/platform/ff200000.drv2025/my_nice_name</span></code>
en utilisant le même platform device que les labos.</p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>sysfs a deux limitations :</p>
<ul class="simple">
<li><p>on ne peut pas utiliser plus qu'une page de mémoire (normalement 4096 bytes)</p></li>
<li><p>idéalement un fichier sysfs = une valeur (plus de détail sur cette règle <a class="reference external" href="https://lwn.net/Articles/378884/">dans cet article</a>)</p></li>
</ul>
<p>Si vous voulez sortir plus d'une valeur, il y a d'autres mécanismes
prévus pour cela (p. ex., <em>debugfs</em>), mais qui vont au-delà des
objectifs de ce cours.</p>
</div>
<div class="admonition-exercice-3-sysfs admonition">
<p class="admonition-title"><strong>Exercice 3 : sysfs</strong></p>
<p>Ajoutez, à l'aide de <code class="code highlight c docutils literal highlight-c"><span class="n">sysfs</span></code>, les fonctionnalités suivantes dans le module de l'exercice précédent :</p>
<ul>
<li><p>Récupérer et modifier l'intervalle du chenillard</p></li>
<li><p>Récupérer le numéro de la LED actuellement allumée (ou -1 si aucune séquence n'est en cours)</p></li>
<li><p>Récupérer le nombre de séquences jouées (i.e. terminées) depuis l'insertion du module dans le noyau</p></li>
<li><p>Récupérer le nombre de séquences encore dans la kfifo</p></li>
<li><p>Récupérer la liste des séquences restantes dans la kfifo, une séquence par ligne
(ce qui enfreint légèrement une des deux limitations énoncées ci-dessus). Par exemple :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat<span class="w"> </span>/sys/devices/platform/soc/ff200000.drv2025/sequence
<span class="go">up</span>
<span class="go">down</span>
<span class="go">down</span>
<span class="go">up</span>
</pre></div>
</div>
</li>
</ul>
</div>
</section>
<section id="synchronisation">
<h2>Synchronisation<a class="headerlink" href="#synchronisation" title="Lien vers cette rubrique">#</a></h2>
<p>Le noyau Linux est conçu pour gérer plusieurs tâches (threads),
potentiellement sur plusieurs processeurs simultanément.
De plus il doit réagir aux événements matériels (interruptions) qui peuvent surgir à n'importe quel moment.
Cela le rend particulièrement exposé aux problèmes de concurrence.</p>
<p>Pour cette raison, il dispose d'un riche ensemble de primitives de synchronisation,
dont vous avez déjà vu certaines en cours :</p>
<ul class="simple">
<li><p>mutex</p></li>
<li><p>spinlock</p></li>
<li><p>variable atomique</p></li>
<li><p>RCU</p></li>
<li><p>et beaucoup d'autres...</p></li>
</ul>
<p>Plusieurs situations peuvent créer des situations d'accès concurrents à des ressources partagées:</p>
<ul class="simple">
<li><p>Des threads user-space qui font appellent aux fonctionnalités exposées par le driver,
par exemple au travers d'un <em>device node</em> ou d'un fichier dans procfs / sysfs / debugfs</p></li>
<li><p>Des threads kernel-space, tels que des kthreads instanciés par le driver lui-même ou tout autre
mécanisme de traitement déféré</p></li>
<li><p>Des événements qui s'exécute en contexte d'interruption, tels que des <em>hardirq</em>, <em>softirq</em> ou <em>tasklets</em>.</p></li>
</ul>
<p>La gestion des accès concurrents dans notre driver passe donc par plusieurs étapes:</p>
<ul class="simple">
<li><p>Il faut d'abord reconnaître les différentes situations d'accès concurrent dans notre driver,
et donc les différentes parties de notre code qui sont exposées à un problème de concurrence</p></li>
<li><p>Il est ensuite possible d'identifier les ressources critiques, soit les ressources partagées
entre plusieurs tâches concurrentes</p></li>
<li><p>Finalement on peut déterminer le meilleur mécanisme de protection pour chaque ressource critique,
notamment en connaissant le contexte dans lequel se fait cet accès. Le plus important est
la distinction entre un contexte <em>process</em> et un contexte d'interruption, ce qui limitera
l'utilisation de certains mécanismes si une attente bloquante est impossible.</p></li>
</ul>
<p>Vous pourrez en apprendre plus sur ce sujet dans
le chapitre 5 de <a class="reference external" href="https://lwn.net/Kernel/LDD3">Linux Device Drivers, 3rd edition</a>.</p>
<div class="admonition-exercice-4-synchronisation admonition">
<p class="admonition-title"><strong>Exercice 4: synchronisation</strong></p>
<p>Ajouter la gestion des accès concurrents aux différentes variables de votre module.
Comme contrainte, vous devez avoir au minimum :</p>
<ul class="simple">
<li><p>Une variable atomique</p></li>
<li><p>Une variable protégée par un spinlock</p></li>
<li><p>Une variable protégée par un mutex</p></li>
</ul>
</div>
</section>
<section id="travail-a-rendre-et-criteres-d-evaluation">
<h2>Travail à rendre et critères d'évaluation<a class="headerlink" href="#travail-a-rendre-et-criteres-d-evaluation" title="Lien vers cette rubrique">#</a></h2>
<p>S'il est demandé d'écrire du code, ce code doit se trouver dans un fichier <em>ex&lt;n&gt;.c</em>, où &lt;n&gt; correspond au numéro de l'exercice.
Si un exercice contient plusieurs variantes, alors le fichier sera nommé <em>ex&lt;n&gt;_&lt;variante&gt;.c</em>, où &lt;variante&gt; correspond à la variante.
Par exemple : <em>ex2.c</em>, <em>ex6_poll.c</em>.
Il n'est pas nécessaire de renommer les fichiers déjà existants.
Si un exercice réutilise un fichier précédent, celui-ci doit être dupliqué pour le nouvel exercice, sauf indication contraire.</p>
<p>Si le code a pour but d'être exécuté sur la DE1-SoC, il doit être compilé en &quot;compilation croisée&quot;,
c.-à-d. en utilisant la toolchain mentionnée dans le <a class="reference internal" href="../lab_01/lab_01.html#laboratoire1"><span class="std std-ref">Laboratoire 1 --- Introduction</span></a>.</p>
<p>N'oubliez pas de mettre votre prénom et nom !</p>
<p>Les exercices sont à faire <strong>individuellement</strong>.
Copier la solution d'un autre et changer le nom/l'ordre des variables n'est pas toléré.</p>
<p>La date limite est celle communiquée dans l'annonce sur Moodle.
Vous devez rendre une archive <code class="file docutils literal notranslate"><span class="pre">.tar.gz</span></code> contenant :</p>
<ul class="simple">
<li><p>le code source de vos solutions et tous les fichiers nécessaires,</p></li>
<li><dl class="simple">
<dt>un fichier <code class="file docutils literal notranslate"><span class="pre">README.md</span></code></dt><dd><ul>
<li><p>contenant les réponses aux questions posées dans les exercices.</p></li>
<li><p>les éventuels soucis rencontrés qui péjore le rendu</p></li>
<li><p>les choix d'implémentation &quot;spéciaux&quot; (si trop long pour expliquer en commentaire)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Les notes seront réparties comme suit :</p>
<ul class="simple">
<li><p>80% de la note si l'exercice est correct (c.-à-d., <em>&quot;fonctionne&quot;</em>).
Il doit bien sûr &quot;fonctionner&quot; sur d'autres PCs que votre PC personnel, et de façon déterministe.
Il est donc impératif que tout ce qui est nécessaire pour compiler et tester le fonctionnement de la solution soit rendu.</p></li>
<li><p>20% de la note si l'exercice est &quot;bien fait&quot;, c.-à-d. :</p>
<ul>
<li><p>Respect des <a class="reference external" href="https://www.kernel.org/doc/html/latest/process/coding-style.html">Linux kernel coding style</a>,
particulièrement les points suivants :</p>
<ul>
<li><ol class="arabic simple">
<li><p>Indentation</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>Breaking long lines and strings</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="3">
<li><p>Placing Braces and Spaces</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="4">
<li><p>Naming</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="6">
<li><p>Functions</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="8">
<li><p>Commenting</p></li>
</ol>
</li>
</ul>
</li>
<li><p><strong>code lisible</strong></p></li>
<li><p><strong>documenté/commenté</strong></p></li>
<li><p><strong>bien structuré</strong></p></li>
</ul>
</li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../tuto_03/tuto_03.html"
       title="page précédente">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title">Tutoriel 3 ---  REDS-adder driver v2.1 et v3.1</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectifs">Objectifs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#materiel-necessaire">Matériel nécessaire</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thread-noyau-kthread">Thread noyau (kthread)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timer-ktimer">Timer (ktimer)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#queue-kfifo">Queue (kfifo)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercices">Exercices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sysfs">Sysfs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronisation">Synchronisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#travail-a-rendre-et-criteres-d-evaluation">Travail à rendre et critères d'évaluation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par REDS institute
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, REDS institute.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>